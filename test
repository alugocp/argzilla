#!/bin/bash

langs=("javascript" "ruby" "python")

# Build the project
printf "Building..."
tsc 2> /dev/null
if [ "$?" != "0" ]; then
  printf "Build failed\n"
  exit 1
fi
printf "Build complete\n"

out="bin/argparse.txt"
configs=( $(ls tests) )
for config in "${configs[@]}"; do
  printf "\nTesting ${config}\n"
  for lang in "${langs[@]}"; do
    printf "${lang}: "
    node bin/index.js -l "$lang" -p > $out
    if [ "$?" == "0" ]; then
      printf "GENERATED, "

      # Language-specific testing
      if [ "$lang" == "javascript" ]; then
        nodejs "$out"
        [ "$?" == "0" ] && printf "RUNS" || printf "ERROR"
      elif [ "$lang" == "ruby" ]; then
        ruby "$out"
        [ "$?" == "0" ] && printf "RUNS" || printf "ERROR"
      elif [ "$lang" == "python" ]; then
        python "$out"
        [ "$?" == "0" ] && printf "RUNS" || printf "ERROR"
      else
        printf "UNKNOWN"
      fi
      # End of language-specific testing

      printf "\n"
    else
      printf "ERROR\n"
    fi
  done
done
